<div align="center">
<h1>『Avendia』生成スクリプト (Version 3)</h1>
</div>

![](https://img.shields.io/github/commit-activity/y/Ziphil/AvendiaTertia?label=commits)
![](https://img.shields.io/github/search/Ziphil/AvendiaTertia/extension:zml?label=pages)


## 概要
シャレイア語公式サイト『[Avendia](http://ziphil.com/)』を生成するためのスクリプトとその原稿ファイルです。

## 設定
変換したファイルの出力先やリモートサーバーのログイン情報などを設定しておく必要があります。
以下の様式の JSON ファイルを `config/config.json` として保存してください。
```jsonc
{
  "server": {
    "host": "********",  // サーバーのホスト名
    "user": "********",  // サーバーのユーザー名
    "password": "********"  // サーバーのパスワード
  },
  "localDomain": {  // ローカルサーバーのドメイン名
    "ja": "http://lbs.localhost",
    "en": "http://en.lbs.localhost"
  },
  "remoteDomain": {  // リモートサーバーのドメイン名
    "ja": "http://ziphil.com",
    "en": "http://en.ziphil.com"
  },
  "documentDirPath": {  // 原稿ファイルが置かれるディレクトリの相対パス
    "ja": "document/ja",
    "en": "document/en"
  },
  "outputDirPath": {  // 変換ファイルの出力先となるディレクトリの絶対パス
    "ja": "C:/Apache24/htdocs/lbs",
    "en": "C:/Apache24/htdocs/lbs-en"
  },
  "remoteDirPath": {  // 変換ファイルのアップロード先となるディレクトリの絶対パス
    "ja": "",
    "en": "en.ziphil.com"
  },
  "logPath": {  // ログファイルの出力先の相対パス
    "ja": "log/ja.txt",
    "en": "log/en.txt",
    "error": "log/error.txt"
  },
  "programPath": {  // CGI のプログラムのパス
    "ruby": "/usr/bin/ruby"
  }
}
```

## 生成
以下のコマンドを実行すると、サイトの全てのページを出力先ディレクトリに生成します。
```
npm start
```
オプション `-u` を付けると、ページの生成と同時にファイルがサーバーにアップロードされます。
```
npm start -- -u
```
オプション `-w` を付けると、変換スクリプトがバックグラウンドで走り、ファイルの変更を検出してそのファイルのみが自動で変換されるようになります。
バックグラウンドスクリプトを終了する場合は、コンソールで Ctrl＋C を入力してください。

以下のようにファイル名を指定すると、全てのファイルではなく指定されたファイルのみを変換します。
ファイルのパスは空白区切りで複数指定することができます。
```
npm start -- (ファイル名の相対パス)
```
この場合も、オプション `-u` を付けることで、ページの生成と同時にファイルをサーバーにアップロードできます。
```
npm start -- -u (ファイル名の相対パス)
```

以下のコマンドによって、特定のファイルを更新したことをスクリプトに通知し、そのことを更新履歴として記録できます。
記録された更新履歴は、ページ原稿中に特定のタグを入れることで表示させることができます。
ただし、このコマンドは更新履歴データを更新するだけなので、実際のページに表示される履歴を更新したい場合は、そのページを別途再生成する必要があります。
```
npm start -- -h (ファイル名の相対パス)
```

変換中にエラーが発生した場合は、その段階ではサイトの生成を停止せず、エラーログを出力しつつ処理を続行します。
変換中にエラーが発生したファイルは、コンソールに出力されるログにおいて黄背景で表示されます。

## 注意点

### 欠損ファイルについて
現在オンライン上にアップロードされているファイルのうち、以下に該当するものはこのリポジトリに含まれていません。
これらは主に、画像や PDF などのバイナリファイルです。
『Avendia』を完全に再現するためには、これらのファイルは別途用意する必要があります。

- .htaccess ファイル
- `document/(言語コード)/file` 以下にあるファイル
- `document/(言語コード)/material` 以下にあるファイル

### サイトの公開について
サイトの管理者である Ziphil の許可を得ずに、このリポジトリに含まれるファイルおよびそれを変換したファイルを、オンラインで公開することを禁じます。
この README の内容は Ziphil の備忘録にすぎず、クローンサイトの公開を推奨するものではありません。